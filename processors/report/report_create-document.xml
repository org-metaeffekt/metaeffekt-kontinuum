<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <!--
    Copyright 2024-2025 the original author or authors.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
    -->

    <parent>
        <groupId>com.metaeffekt.kontinuum</groupId>
        <artifactId>ae-kontinuum-processors</artifactId>
        <version>KONTINUUM-SNAPSHOT</version>
        <relativePath>../_common_/ae-kontinuum-processors.xml</relativePath>
    </parent>

    <artifactId>report_create-document</artifactId>
    <packaging>pom</packaging>

    <properties>
        <param.property.selector.classification>DEFAULT</param.property.selector.classification>
        <param.property.selector.control>DEFAULT</param.property.selector.control>

        <!-- default values for report parameters -->
        <param.document.language>en</param.document.language>

        <!-- FIXME: Check whether this is required -->
        <param.reference.license.dir>${param.reference.inventory.dir}/../licenses</param.reference.license.dir>
        <param.reference.component.dir>${param.reference.inventory.dir}/../components</param.reference.component.dir>

        <param.template.dir>${env.workbench.dir}/templates/report-template</param.template.dir>
        <param.computed.inventory.dir>${param.template.dir}/target/tmp</param.computed.inventory.dir>
        <env.workbench.processors.dir>${env.workbench.dir}/processors</env.workbench.processors.dir>
        <env.kontinuum.processors.dir>${env.kontinuum.dir}/processors</env.kontinuum.processors.dir>
        <param.security.policy.file>${env.workbench.dir}/policies/security-policy/security-policy.json</param.security.policy.file>
    </properties>

    <build>
        <plugins>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>exec-maven-plugin</artifactId>
                <version>3.1.0</version>
                <executions>
                    <execution>
                        <id>invoke-target-pom</id>
                        <phase>verify</phase>
                        <goals>
                            <goal>exec</goal>
                        </goals>
                        <configuration>
                            <executable>mvn</executable>
                            <arguments>
                                <argument>-f</argument>
                                <argument>${param.template.dir}/pom.xml</argument>
                                <argument>clean</argument>
                                <argument>install</argument>
                                <argument>-P${param.document.type}_${param.document.language}</argument>

                                <argument>-Dasset.id=${param.asset.id}</argument>
                                <argument>-Dasset.name=${param.asset.name}</argument>
                                <argument>-Dasset.version=${param.asset.version}</argument>

                                <argument>-Dproduct.version=${param.product.version}</argument>
                                <argument>-Dproduct.name=${param.product.name}</argument>
                                <argument>-Dproduct.watermark=${param.product.watermark}</argument>

                                <argument>-Dinventory.path=${input.inventory.file}</argument>
                                <argument>-Dreference.inventory.path=${param.reference.inventory.dir}</argument>

                                <argument>-Dreference.license.path=${param.reference.license.dir}</argument>
                                <argument>-Dreference.component.path=${param.reference.component.dir}</argument>
                                <argument>-Dparam.computed.inventory.dir=${param.computed.inventory.dir}</argument>
                                <argument>-Dasset.descriptor.file=${param.asset.descriptor.file}</argument>

                                <argument>-Dsecurity.policy.file=${param.security.policy.file}</argument>
                                <argument>-Denv.vulnerability.mirror.dir=${env.vulnerability.mirror.dir}</argument>

                                <argument>-Doverview.advisors=${param.overview.advisors}</argument>

                                <argument>-Doutput.document.file=${output.document.file}</argument>

                                <argument>-Dproperty.selector.organization=${param.property.selector.organization}</argument>
                                <argument>-Dproperty.selector.classification=${param.property.selector.classification}</argument>
                                <argument>-Dproperty.selector.control=${param.property.selector.control}</argument>
                                <argument>-Dproperty.selector.language=${param.document.language}</argument>
                                <argument>-Dtemplate.dir=${param.template.dir}</argument>

                                <argument>-Dworkbench.processors.dir=${env.workbench.processors.dir}</argument>
                                <argument>-Dworkbench.dir=${env.workbench.dir}</argument>
                                <argument>-Dkontinuum.dir=${env.kontinuum.dir}</argument>
                                <argument>-Dkontinuum.processors.dir=${env.kontinuum.processors.dir}</argument>
                            </arguments>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-enforcer-plugin</artifactId>
                <version>3.5.0</version>
                <executions>
                    <execution>
                        <id>enforce-property</id>
                        <goals>
                            <goal>enforce</goal>
                        </goals>
                        <configuration>
                            <rules>
                                <requireProperty>
                                    <property>param.asset.descriptor.file</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>input.inventory.file</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>output.document.file</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>param.document.type</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>param.asset.id</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>param.asset.name</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>param.asset.version</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>param.product.name</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>param.product.version</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>param.product.watermark</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>param.property.selector.organization</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>env.workbench.dir</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>env.kontinuum.dir</property>
                                </requireProperty>
                            </rules>
                            <fail>true</fail>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>