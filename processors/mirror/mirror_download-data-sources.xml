<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">

    <modelVersion>4.0.0</modelVersion>

    <!--
        Copyright 2024-2025 the original author or authors.

        Licensed under the Apache License, Version 2.0 (the "License");
        you may not use this file except in compliance with the License.
        You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing, software
        distributed under the License is distributed on an "AS IS" BASIS,
        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        See the License for the specific language governing permissions and
        limitations under the License.
        -->

    <parent>
        <groupId>com.metaeffekt.kontinuum</groupId>
        <artifactId>ae-kontinuum-processors</artifactId>
        <version>KONTINUUM-SNAPSHOT</version>
        <relativePath>../_common_/ae-kontinuum-processors.xml</relativePath>
    </parent>

    <artifactId>mirror_donwload-data-sources</artifactId>

    <!--FIXME: review how proxy can be configured best; check also resolver approach -->
    <properties>
        <param.proxy.scheme>none</param.proxy.scheme>
        <param.proxy.host>none</param.proxy.host>
        <param.proxy.port>-1</param.proxy.port>
        <param.proxy.user>none</param.proxy.user>
        <param.proxy.pass>none</param.proxy.pass>
    </properties>

    <build>
        <plugins>
            <plugin>
                <groupId>com.metaeffekt.artifact.analysis</groupId>
                <artifactId>ae-mirror-plugin</artifactId>
                <version>${ae.artifact.analysis.version}</version>
                <executions>
                    <execution>
                        <id>data-mirror</id>
                        <goals>
                            <goal>data-mirror</goal>
                        </goals>

                        <configuration>
                            <mirrorDirectory>${env.mirror.dir}</mirrorDirectory>

                            <proxyScheme>${param.proxy.scheme}</proxyScheme>
                            <proxyHost>${param.proxy.host}</proxyHost>
                            <proxyUsername>${param.proxy.user}</proxyUsername>
                            <proxyPassword>${param.proxy.pass}</proxyPassword>
                            <proxyPort>${param.proxy.port}</proxyPort>

                            <!-- fail if an error occurs, but not on incomplete warnings -->
                            <failOnDownloadError>true</failOnDownloadError>
                            <failOnIntegrityError>false</failOnIntegrityError>

                            <!-- Downloads -->

                            <!-- NOTE: the configuration has parts which are commented out. This is based on the following:
                                    - documentation is provided directly on the downloader configuration
                                    - the defaults are visible while still being explicit
                                    - the defaults may change and have an immediate effect without requiring
                                      an immediate adjustment on the configuration.
                                    - the configuration can be regularly synchronized with the reference configuration on
                                      https://github.com/org-metaeffekt/metaeffekt-documentation/blob/main/metaeffekt-vulnerability-management/data-mirror/download.md#pom-configuration

                                 A regular review of the CSAF-Listers and OSV sources is also recommended.
                            -->

                            <nvdCveDownload>
                                <!-- Accessing NVD data sources requires an API key.
                                     Keys can be obtained here. (https://nvd.nist.gov/developers/request-an-api-key)
                                     More information can be found here. (https://nvd.nist.gov/developers/start-here) -->
                                <apiKey>${env.nvd.apikey}</apiKey>

                                <resourceLocations>
                                    <!-- - 'startIndex' 0-based index of the first CVE to be returned in the response data -->
                                    <!-- <CVE_API_LIST_ALL>https://services.nvd.nist.gov/rest/json/cves/2.0?startIndex=%d</CVE_API_LIST_ALL> -->

                                    <!-- The maximum allowable range when using any date range parameters is 120 consecutive days.
                                         Values must be entered in the extended ISO-8061 date/time format:
                                         '[YYYY][“-”][MM][“-”][DD][“T”][HH][“:”][MM][“:”][SS][Z]'
                                         - 'startIndex' 0-based index of the first CVE to be returned in the response data
                                         - 'lastModStartDate' the start date
                                         - 'lastModEndDate' the end date -->
                                    <!-- <CVE_API_START_END_DATE>https://services.nvd.nist.gov/rest/json/cves/2.0/?startIndex=%d&amp;lastModStartDate=%s&amp;lastModEndDate=%s</CVE_API_START_END_DATE> -->
                                </resourceLocations>
                            </nvdCveDownload>

                            <nvdCpeDownload>
                                <!-- Accessing NVD data sources requires an API key.
                                     Keys can be obtained here. (https://nvd.nist.gov/developers/request-an-api-key)
                                     More information can be found here. (https://nvd.nist.gov/developers/start-here) -->
                                <apiKey>${env.nvd.apikey}</apiKey>

                                <resourceLocations>
                                    <!-- - 'startIndex' 0-based index of the first CPE to be returned in the response data -->
                                    <!-- <CPE_API_LIST_ALL>https://services.nvd.nist.gov/rest/json/cpes/2.0?startIndex=%d&amp;resultsPerPage=10000</CPE_API_LIST_ALL> -->

                                    <!-- The maximum allowable range when using any date range parameters is 120 consecutive days.
                                                 Values must be entered in the extended ISO-8061 date/time format:
                                         '[YYYY][“-”][MM][“-”][DD][“T”][HH][“:”][MM][“:”][SS][Z]'
                                         - 'startIndex' 0-based index of the first CPE to be returned in the response data
                                         - 'lastModStartDate' the start date
                                         - 'lastModEndDate' the end date -->
                                    <!-- <CPE_API_START_END_DATE>https://services.nvd.nist.gov/rest/json/cpes/2.0?startIndex=%d&amp;lastModStartDate=%s&amp;lastModEndDate=%s&amp;resultsPerPage=10000</CPE_API_START_END_DATE> -->

                                    <!-- - 'startIndex' 0-based index of the first CPE to be returned in the response data -->
                                    <!-- <CPE_MATCH_API_LIST_ALL>https://services.nvd.nist.gov/rest/json/cpematch/2.0?startIndex=%d</CPE_MATCH_API_LIST_ALL> -->

                                    <!-- The maximum allowable range when using any date range parameters is 120 consecutive days.
                                                 Values must be entered in the extended ISO-8061 date/time format:
                                         '[YYYY][“-”][MM][“-”][DD][“T”][HH][“:”][MM][“:”][SS][Z]'
                                         - 'startIndex' 0-based index of the first CPE to be returned in the response data
                                         - 'lastModStartDate' the start date
                                         - 'lastModEndDate' the end date -->
                                    <!-- <CPE_MATCH_API_START_END_DATE>https://services.nvd.nist.gov/rest/json/cpematch/2.0?startIndex=%d&amp;lastModStartDate=%s&amp;lastModEndDate=%s</CPE_MATCH_API_START_END_DATE> -->
                                </resourceLocations>
                            </nvdCpeDownload>

                            <cveListDownload>
                                <!-- If set to true, the git command is used to clone the repository. Otherwise, the zip download is used.
                                     zip URLs have the following format: https://github.com/owner/repo/archive/refs/heads/main.zip -->
                                <useGitCommand>true</useGitCommand>

                                <resourceLocations>
                                    <!-- Remote repository URL of the
                                         CVEProject/cvelistV5 (https://github.com/CVEProject/cvelistV5) repository. -->
                                    <!-- <GIT_URL>https://github.com/CVEProject/cvelistV5</GIT_URL> -->

                                    <!-- Remote URL of the zip download of the
                                         CVEProject/cvelistV5 (https://github.com/CVEProject/cvelistV5) repository. -->
                                    <!-- <GIT_ZIP_DOWNLOAD_URL>https://github.com/CVEProject/cvelistV5/archive/refs/heads/main.zip</GIT_ZIP_DOWNLOAD_URL> -->
                                </resourceLocations>
                            </cveListDownload>

                            <msrcDownload>
                                <resourceLocations>
                                    <!-- List of all monthly documents. Contains last update date used to determine whether an update is required.
                                         When viewed in a browser, the content will be displayed as XML, but when accessed via the API, the content
                                         will be returned as JSON. -->
                                    <!-- <MSRC_UPDATES_URL>https://api.msrc.microsoft.com/cvrf/v3.0/updates</MSRC_UPDATES_URL> -->

                                    <!-- https://api.msrc.microsoft.com/cvrf/v3.0/swagger/v3/swagger.json (https://api.msrc.microsoft.com/cvrf/v3.0/swagger/v3/swagger.json).
                                         REST-API for the Microsoft Security Response Center (MSRC) Common Vulnerability Reporting Framework (CVRF) v2.0.
                                         - '%s' CVRF document ID (yyyy-mmm) (example: '2021-dec') -->
                                    <!-- <MSRC_CVRF_BASE_URL>https://api.msrc.microsoft.com/cvrf/v3.0/cvrf/%s</MSRC_CVRF_BASE_URL> -->
                                </resourceLocations>
                            </msrcDownload>

                            <msrcSecurityUpdateGuideDownload>
                                <resourceLocations>
                                    <!-- Endpoint that https://msrc.microsoft.com/update-guide/ (https://msrc.microsoft.com/update-guide/)
                                         uses to construct the xlsx and csv files locally.
                                         Has parameters that are filled by the code, without format strings here. -->
                                    <!-- <AFFECTED_PRODUCTS_BASE_URL>https://api.msrc.microsoft.com/sug/v2.0/en-US/affectedProduct</AFFECTED_PRODUCTS_BASE_URL> -->
                                </resourceLocations>
                            </msrcSecurityUpdateGuideDownload>

                            <certSeiDownload>
                                <resourceLocations>
                                    <!-- Summary URL for a given year.
                                         - '%d' Summary year (example: '2020') -->
                                    <!-- <SUMMARY_API_URL>https://kb.cert.org/vuls/api/%d/summary/</SUMMARY_API_URL> -->

                                    <!-- URL for a certain note.
                                         - '%s' Note Identifier (example: '257161') -->
                                    <!-- <NOTES_API_URL>https://kb.cert.org/vuls/api/%s/</NOTES_API_URL> -->
                                </resourceLocations>
                            </certSeiDownload>

                            <certFrDownload>
                                <resourceLocations>
                                    <!-- Cert-FR Base Url.
                                         Used in order to retrieve single entries. Parameters:
                                         - '%s' json_url (example: 'avis/CERTFR-2025-AVI-0251/json/') -->
                                    <!-- <CERT_FR_BASE_URL>https://www.cert.ssi.gouv.fr/%s</CERT_FR_BASE_URL> -->

                                    <!-- Yearly archive download URL. Parameters:
                                         - '%d' Archive year (example: '2020') -->
                                    <!-- <CERT_FR_ARCHIVE>https://metaeffekt.com/mirror/cert-fr/json/%d.tar</CERT_FR_ARCHIVE> -->

                                    <!-- <CERT_FR_ARCHIVE_META>https://metaeffekt.com/mirror/cert-fr/.ae-mirror-info</CERT_FR_ARCHIVE_META> -->

                                    <!-- RSS feed that contains the latest changes to the mirror.
                                         Used to check if update is required. -->
                                    <!-- <CERT_FR_RSS_FEED>https://www.cert.ssi.gouv.fr/feed/</CERT_FR_RSS_FEED> -->

                                    <!-- Paged listing of CERT-FR entries. Parameters:
                                         - '%s' Type of entry (example: 'alerte')
                                         - '%d' Page number
                                         Examples:
                                         - https://www.cert.ssi.gouv.fr/alerte/page/1 (https://www.cert.ssi.gouv.fr/alerte/page/1)
                                         - https://www.cert.ssi.gouv.fr/avis/page/2 (https://www.cert.ssi.gouv.fr/avis/page/1) -->
                                    <!-- <CERT_FR_ENTRY_LISTING_HTML>https://www.cert.ssi.gouv.fr/%s/page/%d</CERT_FR_ENTRY_LISTING_HTML> -->

                                    <!-- Base URL for the CERT-FR. Used to extract the archive year list. -->
                                    <!-- <CERT_FR_BASE_URL_FOR_ARCHIVE_LISTING>https://www.cert.ssi.gouv.fr</CERT_FR_BASE_URL_FOR_ARCHIVE_LISTING> -->

                                    <!-- Listing of all available JSON entries for a CERT-FR advisory type. Parameters:
                                         - '%s' Type of entry (example: 'alerte')
                                         Examples:
                                         - https://www.cert.ssi.gouv.fr/alerte/json (https://www.cert.ssi.gouv.fr/alerte/json) -->
                                    <!-- <CERT_FR_ALL_TYPE_JSON_ENTRIES>https://www.cert.ssi.gouv.fr/%s/json/</CERT_FR_ALL_TYPE_JSON_ENTRIES> -->

                                    <!-- Single JSON entry for a CERT-FR entry. Parameters:
                                         - '%s' Type of entry (example: 'alerte')
                                         - '%s' Entry ID (example: 'CERTFR-2021-ALE-020')
                                         Examples:
                                         - https://www.cert.ssi.gouv.fr/alerte/CERTFR-2021-ALE-020/json (https://www.cert.ssi.gouv.fr/alerte/CERTFR-2021-ALE-020/json) -->
                                    <!-- <CERT_FR_SINGLE_JSON_ENTRY>https://www.cert.ssi.gouv.fr/%s/%s/json/</CERT_FR_SINGLE_JSON_ENTRY> -->
                                </resourceLocations>
                            </certFrDownload>

                            <certEuDownload>
                                <resourceLocations>
                                    <!-- HTML page containing a list of all CERT-EU entries published in a single year.
                                         - '%d' Year (example: '2020') -->
                                    <!-- <YEARLY_PUBLICATIONS_URL>https://cert.europa.eu/publications/security-advisories/%d</YEARLY_PUBLICATIONS_URL> -->

                                    <!-- JSON file containing the details of a single CERT-EU entry.
                                         - '%s' Entry ID (example: '2024-042') -->
                                    <!-- <SINGLE_ENTRY_URL>https://cert.europa.eu/publications/security-advisories/%s/json</SINGLE_ENTRY_URL> -->

                                    <!-- RSS feed for the latest updated/created CERT-EU entries. -->
                                    <!-- <RSS_FEED>https://cert.europa.eu/publications/security-advisories-rss</RSS_FEED> -->
                                </resourceLocations>
                            </certEuDownload>

                            <cisaKevDownload>
                                <resourceLocations>
                                    <!-- URL for the KEV API that is used to fetch all known KEVs known to CISA. -->
                                    <!-- <CISA_KEV>https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json</CISA_KEV> -->
                                </resourceLocations>
                            </cisaKevDownload>

                            <epssDownload>
                                <resourceLocations>
                                    <!-- URL for fetching the current CSV file with the EPSS scores.
                                         Data is of format:
                                         #model_version:v2023.03.01,score_date:2024-04-17T00:00:00+0000
                                         cve,epss,percentile
                                         CVE-1999-0001,0.00383,0.72764
                                         CVE-1999-0002,0.02080,0.88906
                                         CVE-1999-0003,0.04409,0.92276
                                         CVE-1999-0004,0.00917,0.82643
                                         CVE-1999-0005,0.91963,0.98891
                                         Default value: https://epss.cyentia.com/epss_scores-current.csv.gz (https://epss.cyentia.com/epss_scores-current.csv.gz) -->
                                            <!-- <EPSS_ALL_SCORES_CSV>https://epss.cyentia.com/epss_scores-current.csv.gz</EPSS_ALL_SCORES_CSV> -->

                                    <!-- If you would like historical data for EPSS, you can directly access daily files by entering the target date into the URL in this format:
                                         https://epss.cyentia.com/epss_scores-YYYY-mm-dd.csv.gz (https://epss.cyentia.com/epss_scores-YYYY-mm-dd.csv.gz), where YYYY is the four digit year, mm is the two digit month and dd is a two digit day.
                                         For example, if you want to pull February 1st, 2023, you would retrieve https://epss.cyentia.com/epss_scores-2023-02-01.csv.gz (https://epss.cyentia.com/epss_scores-2023-02-01.csv.gz).
                                         - '%s' - Year (YYYY)
                                         - '%s' - Month (mm)
                                         - '%s' - Day (dd) -->
                                    <!-- <EPSS_SPECIFIC_DATE_CSV>https://epss.cyentia.com/epss_scores-%s-%s-%s.csv.gz</EPSS_SPECIFIC_DATE_CSV> -->
                                </resourceLocations>
                            </epssDownload>

                            <eolDownload>
                                <resourceLocations>
                                    <!-- URL for the EOL API that is used to fetch the version information for a single product.
                                         - '%s' the product identifier to fetch the version information for (example: 'java') -->
                                    <!-- <EOL_PRODUCT_VERSIONS>https://endoflife.date/api/%s.json</EOL_PRODUCT_VERSIONS> -->

                                    <!-- URL for the EOL API that is used to fetch all product identifiers.
                                         Returns an array of strings. -->
                                    <!-- <EOL_ALL_PRODUCTS>https://endoflife.date/api/all.json</EOL_ALL_PRODUCTS> -->
                                </resourceLocations>
                            </eolDownload>

                            <githubAdvisorDownload>
                                <!-- If set to true, the git command is used to clone the repository. Otherwise, the zip download is used.
                                     zip URLs have the following format: https://github.com/owner/repo/archive/refs/heads/main.zip -->
                                <useGitCommand>true</useGitCommand>

                                <resourceLocations>
                                    <!-- Remote repository URL of the
                                         github/advisory-database (https://github.com/github/advisory-database) repository. -->
                                    <!-- <GHSA_GIT_URL>https://github.com/github/advisory-database</GHSA_GIT_URL> -->

                                    <!-- Remote URL of the zip download of the
                                         github/advisory-database (https://github.com/github/advisory-database) repository. -->
                                    <!-- <GHSA_GIT_ZIP_DOWNLOAD_URL>https://github.com/github/advisory-database/archive/refs/heads/main.zip</GHSA_GIT_ZIP_DOWNLOAD_URL> -->
                                </resourceLocations>
                            </githubAdvisorDownload>

                            <osvAdvisorDownload>
                                <!-- <useDefaultIncludeEcosystems>true</useDefaultIncludeEcosystems> -->
                                <!-- <useDefaultExcludeEcosystems>true</useDefaultExcludeEcosystems> -->
                                <!-- <includeEcosystems>[]</includeEcosystems> -->
                                <!-- <excludeEcosystems>[]</excludeEcosystems> -->

                                <resourceLocations>
                                    <!-- URL to fetch the list of ecosystems available for download.
                                         Response contains one entry per line. -->
                                    <!-- <ECOSYSTEMS_URL>https://osv-vulnerabilities.storage.googleapis.com/ecosystems.txt</ECOSYSTEMS_URL> -->

                                    <!-- URL to fetch metadata of a specific file, like name, generationId, updated, etc.
                                         - '%s' Ecosystem name (example: 'npm')
                                         - '%s' Wanted File (example: 'zip.all') -->
                                    <!-- <INDIVIDUAL_FILE_METADATA>https://www.googleapis.com/storage/v1/b/osv-vulnerabilities/o/%s%%2F%s</INDIVIDUAL_FILE_METADATA> -->

                                    <!-- URL to download the specified file from the specific location with ecosystem, name, and generationId.
                                         - '%s' Ecosystem name (example: 'npm')
                                         - '%s' Wanted File (example: 'zip.all')
                                         - '%s' GenerationId (example: '1725867421795347') -->
                                    <!-- <DOWNLOAD_FILE>https://www.googleapis.com/download/storage/v1/b/osv-vulnerabilities/o/%s%%2F%s?generation=%s&amp;alt=media</DOWNLOAD_FILE> -->
                                </resourceLocations>
                            </osvAdvisorDownload>

                            <csafDownload>
                                <!-- overwrite default listers to query for providers -->
                                <!--<listerList>
                                    <lister>
                                        <name>BSI</name>
                                        <url>https://wid.cert-bund.de/.well-known/csaf-aggregator/aggregator.json</url>
                                    </lister>
                                </listerList>-->

                                <!-- filter providers fetched using the listers -->
                                <excludeList>
                                    <!-- reason for exclusion: requires additional authentication -->
                                    <url>https://www.huawei.com/.well-known/csaf/provider-metadata.json</url>
                                    <!-- reason for exclusion: requires additional authentication -->
                                    <url>https://psirt.kunbus.com/.well-known/csaf/green</url>
                                    <!-- reason for exclusion: requires additional authentication -->
                                    <url>https://psirt.kunbus.com/.well-known/csaf/amber</url>
                                    <!-- reason for exclusion: requires additional authentication -->
                                    <url>https://psirt.kunbus.com/.well-known/csaf/red</url>
                                    <!-- reason for exclusion: unconsumable data entries -->
                                    <url>https://www.cisa.gov/sites/default/files/csaf/provider-metadata.json</url>
                                </excludeList>

                                <!--<includeList></includeList>-->
                            </csafDownload>

                            <cweDownload>
                                <resourceLocations>
                                    <!-- URL for the CWE Download is used to fetch complete and latest CWE Information. -->
                                    <!-- <MOST_RECENT_CWE>https://cwe.mitre.org/data/xml/cwec_latest.xml.zip</MOST_RECENT_CWE> -->

                                    <!-- This URL is optional but can be used to download the complete CWE information for a specific version. -->
                                    <!-- <SPECIFIC_VERSION_CWE>https://cwe.mitre.org/data/xml/cwec_v%s.xml.zip</SPECIFIC_VERSION_CWE> -->
                                </resourceLocations>
                            </cweDownload>

                            <capecDownload>
                                <resourceLocations>
                                    <!-- <MOST_RECENT_CAPEC_CSV>https://capec.mitre.org/data/archive/capec_latest.zip</MOST_RECENT_CAPEC_CSV> -->

                                    <!-- <MOST_RECENT_CAPEC_XML>https://capec.mitre.org/data/xml/views/2000.xml.zip</MOST_RECENT_CAPEC_XML> -->
                                </resourceLocations>
                            </capecDownload>

                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-enforcer-plugin</artifactId>
                <version>3.5.0</version>
                <executions>
                    <execution>
                        <id>enforce-property</id>
                        <goals>
                            <goal>enforce</goal>
                        </goals>
                        <configuration>
                            <rules>
                                <requireProperty>
                                    <property>env.mirror.dir</property>
                                </requireProperty>
                                <requireProperty>
                                    <property>env.nvd.apikey</property>
                                </requireProperty>
                            </rules>
                            <fail>true</fail>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>
