<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://maven.apache.org/POM/4.0.0"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <!--
        Copyright 2024-2025 the original author or authors.

        Licensed under the Apache License, Version 2.0 (the "License");
        you may not use this file except in compliance with the License.
        You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing, software
        distributed under the License is distributed on an "AS IS" BASIS,
        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        See the License for the specific language governing permissions and
        limitations under the License.
        -->

    <parent>
        <groupId>com.metaeffekt.kontinuum</groupId>
        <artifactId>ae-kontinuum-processors</artifactId>
        <version>KONTINUUM-SNAPSHOT</version>
        <relativePath>../_common_/ae-kontinuum-processors.xml</relativePath>
    </parent>

    <artifactId>mirror_update-index</artifactId>

    <properties>
        <param.proxy.scheme>none</param.proxy.scheme>
        <param.proxy.host>none</param.proxy.host>
        <param.proxy.port>-1</param.proxy.port>
        <param.proxy.user>none</param.proxy.user>
        <param.proxy.pass>none</param.proxy.pass>
    </properties>

    <build>
        <plugins>
            <plugin>
                <groupId>com.metaeffekt.artifact.analysis</groupId>
                <artifactId>ae-mirror-plugin</artifactId>
                <version>${ae.artifact.analysis.version}</version>

                <executions>
                    <execution>
                        <id>data-index</id>
                        <goals>
                            <goal>data-mirror</goal>
                        </goals>

                        <configuration>
                            <mirrorDirectory>${env.mirror.dir}</mirrorDirectory>

                            <!-- fail if an error occurs, but not on incomplete warnings -->
                            <failOnIndexError>true</failOnIndexError>
                            <failOnIntegrityError>false</failOnIntegrityError>

                            <!-- Indexers -->

                            <!-- NOTE:
                                    - the configuration can be regularly synchronized with the reference configuration on
                                      https://github.com/org-metaeffekt/metaeffekt-documentation/blob/main/metaeffekt-vulnerability-management/data-mirror/index.md#pom-configuration
                            -->

                            <certFrAdvisorIndex/>
                            <csafVulnerabilityIndex/>
                            <nvdCpeIndex/>
                            <nvdCpeVendorProductIndex/>
                            <nvdVulnerabilityIndex/>

                            <osvAdvisorIndex>
                                <!-- <useDefaultExcludeAdvisoryProviders>true</useDefaultExcludeAdvisoryProviders> -->
                                <!-- <excludeAdvisoryProviders>[]</excludeAdvisoryProviders> -->
                            </osvAdvisorIndex>

                            <certSeiAdvisorIndex/>
                            <msrcProductIndex/>
                            <msrcAdvisorIndex/>
                            <msrcKbChainIndex/>
                            <certEuAdvisorIndex/>
                            <csafAdvisoryIndex/>
                            <capecIndex/>
                            <kevIndex/>
                            <eolIndex/>
                            <cweIndex/>
                            <epssIndex/>


                            <!-- The NVD and other vendors often publish data which contain invalid CPEs; this configuration attempts to 'correct' the malformed CPEs -->
                            <!-- A simple "cpeCorrection" has a target string ("malformedCpe") and a replacement string ("replacementCpe") which function as 1:1 text replacements -->
                            <cpeCorrections>
                                <!-- SPECIFIC SIMPLE CORRECTIONS -->

                                <!-- duplicate cpe header; can be remove if using gen5 -->
                                <cpeCorrection>
                                    <malformedCpe>cpe:2.3:a:cpe:2.3:a:campcodes:online_feeds_product_inventory_system:1.0:*:*:*:*:*:*:*</malformedCpe>
                                    <replacementCpe>cpe:2.3:a:campcodes:online_feeds_product_inventory_system:1.0:*:*:*:*:*:*:*</replacementCpe>
                                </cpeCorrection>
                                <!-- duplicate '*' character; can be remove if using gen5 -->
                                <cpeCorrection>
                                    <malformedCpe>cpe:2.3:a:strapi:strapi:*:*:*:*:*:**:*:*</malformedCpe>
                                    <replacementCpe>cpe:2.3:a:strapi:strapi:*:*:*:*:*:*:*:*</replacementCpe>
                                </cpeCorrection>
                                <!-- part and vendor melted together -->
                                <cpeCorrection>
                                    <malformedCpe>cpe:2.3:aainwp:onestore_sites:*:*:*:*:*:*:wordpress:*:*</malformedCpe>
                                    <replacementCpe>cpe:2.3:a:sainwp:onestore_sites:*:*:*:*:*:wordpress:*:*</replacementCpe>
                                </cpeCorrection>
                                <!-- missing part -->
                                <cpeCorrection>
                                    <malformedCpe>cpe:2.3:sainwp:onestore_sites:*:*:*:*:*:*:wordpress:*:*</malformedCpe>
                                    <replacementCpe>cpe:2.3:a:sainwp:onestore_sites:*:*:*:*:*:wordpress:*:*</replacementCpe>
                                </cpeCorrection>
                                <!-- too many parts -->
                                <cpeCorrection>
                                    <malformedCpe>cpe:2.3:a:sainwp:onestore_sites:*:*:*:*:*:*:wordpress:*:*</malformedCpe>
                                    <replacementCpe>cpe:2.3:a:sainwp:onestore_sites:*:*:*:*:*:wordpress:*:*</replacementCpe>
                                </cpeCorrection>

                                <!-- repair product name with unescaped ':'; for testing gen4 -->
                                <cpeCorrection>
                                    <malformedCpe>cpe:2.3:a:ibm:sterling_connect:express_for_windows:3.1.0.0:*:*:*:*:*:*:*</malformedCpe>
                                    <replacementCpe>cpe:2.3:a:ibm:sterling_connect\:express_for_windows:3.1.0.0:*:*:*:*:*:*:*</replacementCpe>
                                </cpeCorrection>

                            </cpeCorrections>

                            <!-- Using "cpePatternCorrections" on the other hand, the "malformedCpe" accepts a regular expression (must be enclosed with '/' character) -->
                            <!-- the "replacementCpe" may then either hold the full pattern replacement or some substitution values -->
                            <!-- The order of the regex "cpePatternCorrections" is important, as they also specify the order the replacements are performed -->

                            <cpePatternCorrections>
                                <!-- GENERAL REGEX CORRECTIONS -->

                                <!-- trim whitespaces from beginning and end -->
                                <cpeCorrection>
                                    <malformedCpe>/^\s+(.*?)\s+$/</malformedCpe>
                                    <replacementCpe>$1</replacementCpe>
                                </cpeCorrection>
                                <!-- whitespaces surrounding the delimiter character ':' are collapsed -->
                                <cpeCorrection>
                                    <malformedCpe>/: +| +:/</malformedCpe>
                                    <replacementCpe>:</replacementCpe>
                                </cpeCorrection>
                                <!-- any other remaining whitespaces are replaced with the '_' character, as defined by the cpe spec -->
                                <cpeCorrection>
                                    <malformedCpe>/ +/</malformedCpe>
                                    <replacementCpe>_</replacementCpe>
                                </cpeCorrection>
                                <!-- cpes may not contain multiple asterisk characters in sequence and are therefore collapsed as well -->
                                <cpeCorrection>
                                    <malformedCpe>/\*\*/</malformedCpe>
                                    <replacementCpe>*</replacementCpe>
                                </cpeCorrection>
                                <!-- another common mistake is doubling the cpe header; if present, it is collapsed and the first configured part is used -->
                                <cpeCorrection>
                                    <malformedCpe>/^cpe:2\.3:([aoh]):cpe:2\.3:[aoh]/</malformedCpe>
                                    <replacementCpe>cpe:2.3:$1</replacementCpe>
                                </cpeCorrection>

                                <!-- SPECIFIC REGEX CORRECTIONS -->

                                <!-- non-escaped ":" -->
                                <cpeCorrection>
                                    <malformedCpe>/cpe:2.3:a:ibm:sterling_connect:(.*?):(.*?):\*:\*:\*:\*:(.*?):\*:\*/</malformedCpe>
                                    <replacementCpe>cpe:2.3:a:ibm:sterling_connect\\:$1:$2:*:*:*:*:$3:*:*</replacementCpe>
                                </cpeCorrection>
                                <!-- too many parts -->
                                <cpeCorrection>
                                    <malformedCpe>/cpe:2.3:o:palo_alto_networks:pan-os:(.*?):-:\*:\*:\*:\*:\*:\*:\*/</malformedCpe>
                                    <replacementCpe>cpe:2.3:o:palo_alto_networks:pan-os:$1:-:*:*:*:*:*:*</replacementCpe>
                                </cpeCorrection>
                            </cpePatternCorrections>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-enforcer-plugin</artifactId>
                <version>3.5.0</version>
                <executions>
                    <execution>
                        <id>enforce-property</id>
                        <goals>
                            <goal>enforce</goal>
                        </goals>
                        <configuration>
                            <rules>
                                <requireProperty>
                                    <property>env.mirror.dir</property>
                                </requireProperty>
                            </rules>
                            <fail>true</fail>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>
